#
# Makefile for the common code library project. 
# This probably requires GNU make.
#

DEFS   = @DEFS@
CFLAGS = @CFLAGS@ $(DEFS)
LIBS   = @LIBS@
CC     = @CC@
AR     = ar
RANLIB = @RANLIB@
HOST   = @host@

OBJS = crypt_random.o debug.o mbus.o mbus_config.o md5.o memory.o net_udp.o \
       qfDES.o util.o hmac.o base64.o rtp.o drand48.o \
       btree.o @LIBOBJS@

TEST_OBJS = test_base64.o test_des.o test_md5.o test.o

SRCS = $(OBJS:%.o=%.c)

all: version.h libcommon.a test-libcommon

test-libcommon: $(TEST_OBJS) libcommon.a
	$(CC) $(TEST_OBJS) $(CFLAGS) libcommon.a $(LIBS) -o test-libcommon
	
libcommon.a: $(OBJS)
	$(AR) r libcommon.a $(OBJS)
	$(RANLIB) libcommon.a

version.h:	VERSION
	sed -e 's/.*/#define CCL_VERSION "CCL v& $(HOST)"/' VERSION > version.h

.c.o:
	$(CC) $(CFLAGS) $(INC) -c $<

clean:
	-rm -f $(OBJS) $(TEST_OBJS) version.h libcommon.a tags test-libcommon

distclean:	clean
	-rm -f Makefile config.status config.cache config.h

etags:
	etags *.[ch]

ctags:
	ctags *.[ch]

release:
	cvs tag release-`cat VERSION | sed "s/\./-/g"`

depend: $(SRCS)
	makedepend $(INC) $(SRCS)

